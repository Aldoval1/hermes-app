<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lotería Nacional - Gobierno de San Andreas</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        .header h1 {
            color: #2c3e50;
        }
        .back-link {
            text-decoration: none;
            color: #7f8c8d;
            font-size: 14px;
        }

        /* Jackpot */
        .jackpot-container {
            background: linear-gradient(135deg, #8e44ad, #9b59b6);
            color: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(142, 68, 173, 0.3);
            margin-bottom: 40px;
        }
        .jackpot-label {
            font-size: 24px;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 10px;
        }
        .jackpot-amount {
            font-size: 64px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        /* Timer */
        .timer-container {
            margin-bottom: 40px;
        }
        .timer-label {
            font-size: 18px;
            color: #7f8c8d;
            margin-bottom: 5px;
        }
        .timer {
            font-size: 48px;
            font-weight: bold;
            color: #34495e;
            font-family: monospace;
        }

        /* Buy Ticket */
        .buy-container {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            margin-bottom: 40px;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }
        input[type="text"] {
            width: 100%;
            padding: 15px;
            font-size: 24px;
            text-align: center;
            letter-spacing: 5px;
            margin-bottom: 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
            box-sizing: border-box;
        }
        button {
            background-color: #27ae60;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            width: 100%;
            transition: background 0.3s;
        }
        button:hover {
            background-color: #2ecc71;
        }

        /* My Tickets */
        .tickets-container {
            text-align: left;
            background-color: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        .ticket-list {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
        }
        .ticket-item {
            background-color: #f1c40f;
            color: #d35400;
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: bold;
            font-size: 18px;
            border: 2px dashed #d35400;
        }

        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
            color: white;
        }
        .alert-success { background-color: #27ae60; }
        .alert-error { background-color: #c0392b; }
        .error-msg { color: #c0392b; font-size: 14px; margin-top: 5px; display: block;}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <a href="{{ url_for('main.index') }}" class="back-link">← Volver al Panel</a>
            <h1>Lotería Nacional</h1>
        </div>

        {% with messages = get_flashed_messages() %}
            {% if messages %}
                {% for message in messages %}
                    <div class="alert {% if 'éxito' in message %}alert-success{% else %}alert-error{% endif %}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <div class="jackpot-container">
            <div class="jackpot-label">Gran Premio</div>
            <div class="jackpot-amount">${{ "{:,.0f}".format(lottery.current_jackpot) }}</div>
        </div>

        <div class="timer-container">
            <div class="timer-label">Sorteo en:</div>
            <div class="timer" id="countdown">--:--:--</div>
        </div>

        <div class="buy-container">
            <h3>Comprar Ticket</h3>
            <p style="color: #7f8c8d; margin-bottom: 20px;">Costo por ticket: $500</p>
            <form method="POST" action="{{ url_for('main.buy_lottery_ticket') }}">
                {{ form.hidden_tag() }}
                {{ form.numbers(placeholder="00000", maxlength="5") }}
                {% for error in form.numbers.errors %}
                    <span class="error-msg">{{ error }}</span>
                {% endfor %}
                <button type="submit">JUGAR</button>
            </form>
        </div>

        <div class="tickets-container">
            <h3 style="text-align: center; color: #2c3e50;">Tus Tickets de Hoy</h3>
            <div class="ticket-list">
                {% for ticket in my_tickets %}
                    <div class="ticket-item">
                        <i class="fas fa-ticket-alt"></i> {{ ticket.numbers }}
                    </div>
                {% else %}
                    <p style="width: 100%; text-align: center; color: #7f8c8d;">No has comprado tickets hoy.</p>
                {% endfor %}
            </div>
        </div>
    </div>

    <script>
        function updateTimer() {
            const now = new Date();
            const target = new Date();
            target.setHours(23, 59, 59, 999);

            let diff = target - now;
            if (diff < 0) {
                // If past 23:59:59 but technically same day (unlikely due to setHours) or just passed
                // Reset for next day display or show 00:00:00
                diff = 0;
            }

            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);

            document.getElementById('countdown').innerText =
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        setInterval(updateTimer, 1000);
        updateTimer();
    </script>
</body>
</html>